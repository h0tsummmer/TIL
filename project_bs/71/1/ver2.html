<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CodeSpitz71-1(VER#2)</title>
</head>
<body>
  <section id="data"></sction>

  <script>
  const Loader = class{
    constructor(url){
      if(!url || typeof url !== 'string') throw 'Invalid url';
      this._url = url;
    }
    async load(end){
      const response = await fetch(this._url);
      if(!response.ok) throw 'Data Load Failed';
      const json = await response.json();
      if(!json || !json.title || !json.header || !json.items) throw 'Invalid data';
      const {title, header, items} = json;
      end({title, header, items});
    }
  };
  const Renderer = (_=>{
    const Private = Symbol();
    return class{
    	constructor(parent){
    		if(!parent) throw 'Invalid parent';
    		this[Private] = {parent};
    	}
      setData(data){
        if(!data || !data.title || !data.header || !data.items) throw 'Invalid data';
        Object.assign(this[Private], data);
      }
    	render(){
        const fields = this[Private];
    		const parent = document.querySelector(fields.parent);
        if(!parent) throw 'Invalid Parent Element';
    		parent.innerHTML = '';
    		const table = document.createElement('table');
    		const caption = document.createElement('caption');
        caption.innerHTML = fields.title;
    		table.appendChild(caption);
    		table.appendChild(
    			fields.header.reduce((thead, data)=>{
    				const th = document.createElement('th');
    				th.innerHTML = data;
    				thead.appendChild(th);
    				return thead;
    			}, document.createElement('thead'))
    		);
    		parent.appendChild(table);
    		parent.appendChild(
    			fields.items.reduce((table, row)=>{
    				table.appendChild(
              row.reduce((tr, data)=>{
      					const td = document.createElement('td');
                td.innerHTML = data;
      					tr.appendChild(td);
      					return tr;
      				}, document.createElement('tr'))
            );
    				return table;
    			}, table)
    		);
    	}
    }
  })();
  const loader = new Loader("71_1.json");
  loader.load((json)=>{
    const renderer = new Renderer("#data");
    renderer.setData(json);
    renderer.render();
  });
  </script>
</body>
</html>
