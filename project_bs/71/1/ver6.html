<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CodeSpitz71-1(VER#6)</title>
</head>
<body>
  <section id="data"></sction>

<script>
const Info = class{
  constructor(data){
    const {title, header, items} = data;
    if(typeof title != 'string' || !title) throw "invalid title";
    if(!Array.isArray(header) || !header.length) throw "invalid header";
    if(!Array.isArray(items) || !items.length) throw "invalid items";
    this._private = {title, header, items};
  }
  get title(){ return this._private.title; }
  get header(){ return this._private.header; }
  get items(){ return this._private.items; }
};
const Data = class{
  async getData(){
    const json = await this._getData();
    return new Info(json);
  }
  async _getData(){ throw '_getData must be overridden'; }
};
const JsonData = class extends Data{
  constructor(url){
    super();
    if(!url || typeof url !== 'string') throw 'Invalid url';
    this._url = url;
  }
  async _getData(){
    const response = await fetch(this._url);
    if(!response.ok) throw 'Data Load Failed';
    return await response.json();
  }
};
const Renderer = class{
  async render(data){
    if(!data || !(data instanceof Data)) throw 'Invalid data type';
    const info = await data.getData();
    this._title = info.title;
    this._header = info.header;
    this._items = info.items;
    this._render();
  }
	_render(){ '_render must be overridden'; }
};
const TableRenderer = class extends Renderer{
  constructor(parent){
    super();
    if(!parent) throw 'Invalid parent';
    this._parent = parent;
	}
  _render(){
    const parent = document.querySelector(this._parent);
    if(!parent) throw 'Invalid Parent Element';
    parent.innerHTML = '';
    const table = document.createElement('table');
    const caption = document.createElement('caption');
    caption.innerHTML = this._title;
    table.appendChild(caption);
    table.appendChild(
      this._header.reduce((thead, data)=>{
        const th = document.createElement('th');
        th.innerHTML = data;
        thead.appendChild(th);
        return thead;
      }, document.createElement('thead'))
    );
    parent.appendChild(table);
		parent.appendChild(
      this._items.reduce((table, row)=>{
        table.appendChild(
          row.reduce((tr, data)=>{
            const td = document.createElement('td');
            td.innerHTML = data;
            tr.appendChild(td);
            return tr;
          }, document.createElement('tr'))
        );
        return table;
      }, table)
    );
  }
};
const tableRenderer = new TableRenderer("#data");
tableRenderer.render(new JsonData("71_1.json"));
</script>
</body>
</html>
